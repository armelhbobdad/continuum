# Privacy Test Container
# Uses oven/bun:1.3.5 to match project's Bun runtime (packageManager in package.json)
# Per ADR-TEST-001: Use Bun base image to avoid test/production mismatch

FROM oven/bun:1.3.5

WORKDIR /app

# Copy package files first for layer caching
COPY package.json bun.lock ./

# Install dependencies (requires network - done during build)
# Note: --frozen-lockfile removed due to platform-specific lockfile differences
# Dependencies still follow lockfile versions
RUN bun install

# Copy source code
COPY . .

# Set environment variable to enable network isolation tests
ENV PRIVACY_GATE_CI=true

# Run privacy gate tests
# These tests verify no network calls occur in local-only mode
CMD ["bun", "run", "test:privacy-gate"]
